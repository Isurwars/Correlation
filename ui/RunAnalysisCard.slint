// Correlation - Liquid and Amorphous Solid Analysis Tool
// Copyright © 2013-2026 Isaías Rodríguez (isurwars@gmail.com)
// SPDX-License-Identifier: MIT
// Full license: https://github.com/Isurwars/Correlation/blob/main/LICENSE

import {
    MaterialPalette,
    MaterialStyleMetrics,
    MaterialTypography,
    FilledButton,
    OutlinedCard,
    MaterialText,
    CheckBox,
    CheckState,
    TextField,
} from "@material";

export component RunAnalysisCard inherits OutlinedCard {
    in property <bool> file_loaded;
    in property <bool> analysis_running;
    in-out property <string> analysis_status_text;
    in-out property <bool> use_csv: true;
    in-out property <bool> use_hdf5: true;
    in-out property <string> min_frame;
    in-out property <string> max_frame;
    callback run_analysis();

    // Hover state for tooltip
    out property <bool> analysis_area_has_hover: analysis_area.has-hover;
    out property <bool> hdf5_area_has_hover: hdf5_area.has-hover;
    out property <bool> csv_area_has_hover: csv_area.has-hover;

    VerticalLayout {
        padding: MaterialStyleMetrics.padding_16;
        spacing: MaterialStyleMetrics.spacing_12;
        MaterialText {
            text: "5. Run Analysis";
            style: MaterialTypography.title_medium;
        }

        HorizontalLayout {
            spacing: MaterialStyleMetrics.spacing_8;
            csv_area := TouchArea {
                horizontal-stretch: 1;
                HorizontalLayout {
                    padding: MaterialStyleMetrics.padding_4;
                    Text {
                        vertical-alignment: center;
                        text: "Export as CSV";
                        width: 60%;
                    }

                    CheckBox {
                        enabled: root.file_loaded;
                        width: 20%;
                        check_state: root.use_csv ? CheckState.checked : CheckState.unchecked;
                        checked_state_changed(s) => {
                            root.use_csv = (s == CheckState.checked);
                        }
                    }
                }
            }

            hdf5_area := TouchArea {
                horizontal-stretch: 1;
                HorizontalLayout {
                    padding: MaterialStyleMetrics.padding_4;
                    Text {
                        vertical-alignment: center;
                        text: "Export as HDF5";
                        width: 60%;
                    }

                    CheckBox {
                        enabled: root.file_loaded;
                        width: 20%;
                        check_state: root.use_hdf5 ? CheckState.checked : CheckState.unchecked;
                        checked_state_changed(s) => {
                            root.use_hdf5 = (s == CheckState.checked);
                        }
                    }
                }
            }
        }

        HorizontalLayout {
            spacing: MaterialStyleMetrics.spacing_8;
            TouchArea {
                horizontal-stretch: 1;
                TextField {
                    enabled: root.file_loaded;
                    width: 100%;
                    label: "Min Frame";
                    text <=> root.min_frame;
                }
            }

            TouchArea {
                horizontal-stretch: 1;
                TextField {
                    enabled: root.file_loaded;
                    width: 100%;
                    label: "Max Frame";
                    text <=> root.max_frame;
                }
            }
        }

        analysis_area := TouchArea {
            min-height: 50px;
            FilledButton {
                height: 100%;
                width: 100%;
                text: root.analysis_running ? "Analysis in Progress..." : "Run Analysis";
                enabled: root.file_loaded && !root.analysis_running;
                clicked => {
                    root.run_analysis();
                }
            }
        }
    }
}
